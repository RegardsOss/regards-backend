/*
 * Copyright 2017-2022 CNES - CENTRE NATIONAL d'ETUDES SPATIALES
 *
 * This file is part of REGARDS.
 *
 * REGARDS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * REGARDS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with REGARDS. If not, see <http://www.gnu.org/licenses/>.
 */
package fr.cnes.regards.modules.indexer.service;

import com.google.common.collect.Lists;
import fr.cnes.regards.modules.indexer.dao.spatial.GeoHelper;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.List;

/**
 * @author LÃ©o Mieulet
 */
@RunWith(SpringRunner.class)
public class GeoHelperTest {

    @Test
    public void testSanitizePolygoneIssueThor() {
        double[][][] polygonFailingOnThor = new double[][][] {
            { { -146.33, 74.64 }, { -91.35, 66.92 }, { -89.32, 65.97 }, { -87.43, 65.03 }, { -85.61, 64.08 },
                { -83.99, 63.08 }, { -82.41, 62.08 }, { -80.94, 61.03 }, { -79.56, 59.97 }, { -78.38, 58.92 },
                { -77.14, 57.92 }, { -76.05, 56.81 }, { -74.99, 55.75 }, { -73.97, 54.64 }, { -73.04, 53.53 },
                { -72.1, 52.42 }, { -71.23, 51.25 }, { -70.43, 50.19 }, { -69.68, 49.08 }, { -68.94, 47.92 },
                { -68.21, 46.81 }, { -67.51, 45.64 }, { -66.9, 44.53 }, { -66.22, 43.31 }, { -65.66, 42.19 },
                { -65.07, 41.03 }, { -64.52, 39.86 }, { -63.97, 38.64 }, { -63.42, 37.53 }, { -62.96, 36.36 },
                { -62.46, 35.14 }, { -61.98, 34.03 }, { -61.53, 32.86 }, { -61.08, 31.69 }, { -60.66, 30.53 },
                { -60.24, 29.31 }, { -59.82, 28.14 }, { -59.43, 26.97 }, { -59.02, 25.69 }, { -58.65, 24.53 },
                { -58.28, 23.31 }, { -57.93, 22.19 }, { -57.57, 20.97 }, { -57.19, 19.81 }, { -56.88, 18.58 },
                { -56.56, 17.36 }, { -56.21, 16.19 }, { -55.91, 14.92 }, { -55.58, 13.81 }, { -55.29, 12.53 },
                { -54.99, 11.36 }, { -54.67, 10.19 }, { -54.67, 10.14 }, { -54.37, 8.97 }, { -54.08, 7.81 },
                { -54.08, 7.75 }, { -53.82, 6.58 }, { -53.82, 6.53 }, { -53.54, 5.36 }, { -53.54, 5.31 },
                { -53.23, 4.19 }, { -52.98, 2.97 }, { -52.98, 2.92 }, { -52.71, 1.69 }, { -52.42, 0.53 },
                { -52.42, 0.47 }, { -52.42, 0.42 }, { -52.19, -0.69 }, { -52.19, -0.75 }, { -51.89, -1.86 },
                { -51.89, -1.92 }, { -51.89, -1.97 }, { -51.66, -3.19 }, { -51.41, -4.42 }, { -51.15, -5.53 },
                { -51.15, -5.58 }, { -50.93, -6.75 }, { -50.68, -7.97 }, { -50.42, -9.31 }, { -50.2, -10.47 },
                { -49.95, -11.64 }, { -49.95, -11.69 }, { -49.72, -12.81 }, { -49.72, -12.86 }, { -49.51, -14.03 },
                { -49.51, -14.08 }, { -49.28, -15.31 }, { -49.04, -16.47 }, { -48.79, -17.75 }, { -48.55, -18.97 },
                { -48.33, -20.19 }, { -48.12, -21.36 }, { -47.86, -22.58 }, { -47.67, -23.75 }, { -47.42, -25.03 },
                { -47.23, -26.25 }, { -46.99, -27.47 }, { -46.8, -28.64 }, { -46.57, -29.92 }, { -46.35, -31.08 },
                { -46.13, -32.36 }, { -45.92, -33.58 }, { -45.71, -34.69 }, { -45.48, -35.97 }, { -45.26, -37.25 },
                { -45.05, -38.42 }, { -44.84, -39.64 }, { -44.63, -40.86 }, { -44.42, -42.08 }, { -44.2, -43.25 },
                { -43.99, -44.53 }, { -43.79, -45.69 }, { -43.56, -46.92 }, { -43.33, -48.14 }, { -43.12, -49.36 },
                { -42.86, -50.53 }, { -42.62, -51.69 }, { -42.38, -52.86 }, { -42.1, -54.19 }, { -41.87, -55.36 },
                { -41.65, -56.53 }, { -41.41, -57.69 }, { -41.15, -58.92 }, { -40.91, -60.25 }, { -40.72, -61.53 },
                { -40.45, -62.75 }, { -40.23, -63.92 }, { -40.02, -65.08 }, { -39.7, -66.19 }, { -39.34, -67.19 },
                { -38.89, -68.25 }, { -38.32, -69.42 }, { -37.75, -70.53 }, { -37.13, -71.92 }, { -36.52, -73.25 },
                { -35.98, -74.64 }, { -35.56, -76.03 }, { -35.27, -77.31 }, { -34.96, -78.58 }, { -34.69, -79.53 },
                { -34.13, -80.58 }, { -33.4, -81.53 }, { -31.85, -82.53 }, { -29.83, -83.64 }, { 26.63, -73.58 },
                { 23.07, -73.14 }, { 20.26, -72.53 }, { 17.47, -71.75 }, { 15.09, -70.97 }, { 12.51, -70.14 },
                { 9.51, -69.31 }, { 6.42, -68.42 }, { 3.27, -67.53 }, { 0.35, -66.58 }, { -2.22, -65.64 },
                { -4.35, -64.69 }, { -6.09, -63.75 }, { -7.37, -62.86 }, { -8.56, -61.92 }, { -9.58, -61.03 },
                { -10.72, -59.97 }, { -11.91, -58.97 }, { -13.19, -57.81 }, { -14.34, -56.75 }, { -15.5, -55.64 },
                { -16.59, -54.47 }, { -17.57, -53.42 }, { -18.55, -52.25 }, { -19.42, -51.08 }, { -20.2, -50.03 },
                { -21.04, -48.81 }, { -21.78, -47.75 }, { -22.45, -46.64 }, { -23.15, -45.42 }, { -23.74, -44.36 },
                { -24.4, -43.14 }, { -25.01, -42.03 }, { -25.6, -40.86 }, { -26.17, -39.69 }, { -26.71, -38.47 },
                { -27.28, -37.31 }, { -27.81, -36.08 }, { -28.28, -34.92 }, { -28.72, -33.81 }, { -29.22, -32.53 },
                { -29.65, -31.42 }, { -30.12, -30.19 }, { -30.53, -29.03 }, { -30.95, -27.86 }, { -31.36, -26.64 },
                { -31.77, -25.42 }, { -32.14, -24.25 }, { -32.51, -23.03 }, { -32.88, -21.81 }, { -33.26, -20.58 },
                { -33.55, -19.47 }, { -33.9, -18.25 }, { -34.25, -17.03 }, { -34.56, -15.86 }, { -34.88, -14.64 },
                { -35.21, -13.42 }, { -35.51, -12.31 }, { -35.51, -12.25 }, { -35.85, -10.97 }, { -36.16, -9.81 },
                { -36.44, -8.64 }, { -36.72, -7.42 }, { -37.02, -6.25 }, { -37.02, -6.19 }, { -37.02, -6.14 },
                { -37.28, -5.03 }, { -37.55, -3.86 }, { -37.55, -3.81 }, { -37.84, -2.64 }, { -37.84, -2.58 },
                { -38.1, -1.42 }, { -38.36, -0.25 }, { -38.36, -0.19 }, { -38.64, 0.97 }, { -38.89, 2.19 },
                { -39.16, 3.42 }, { -39.16, 3.47 }, { -39.44, 4.64 }, { -39.44, 4.69 }, { -39.68, 5.81 },
                { -39.68, 5.86 }, { -39.68, 5.92 }, { -39.93, 7.03 }, { -40.17, 8.25 }, { -40.17, 8.31 },
                { -40.41, 9.42 }, { -40.41, 9.47 }, { -40.68, 10.64 }, { -40.68, 10.69 }, { -40.9, 11.86 },
                { -41.14, 13.03 }, { -41.36, 14.25 }, { -41.36, 14.31 }, { -41.6, 15.53 }, { -41.84, 16.64 },
                { -42.05, 17.86 }, { -42.3, 19.08 }, { -42.54, 20.25 }, { -42.78, 21.47 }, { -42.97, 22.69 },
                { -43.22, 23.86 }, { -43.42, 25.14 }, { -43.67, 26.31 }, { -43.86, 27.47 }, { -44.11, 28.69 },
                { -44.33, 29.92 }, { -44.53, 31.08 }, { -44.8, 32.31 }, { -44.98, 33.58 }, { -45.2, 34.75 },
                { -45.45, 35.92 }, { -45.64, 37.08 }, { -45.85, 38.31 }, { -46.1, 39.47 }, { -46.3, 40.75 },
                { -46.51, 41.86 }, { -46.75, 43.08 }, { -47, 44.31 }, { -47.22, 45.53 }, { -47.45, 46.64 },
                { -47.72, 47.92 }, { -47.92, 49.03 }, { -48.15, 50.31 }, { -48.39, 51.47 }, { -48.62, 52.69 },
                { -48.88, 53.81 }, { -49.1, 55.03 }, { -49.37, 56.19 }, { -49.61, 57.36 }, { -49.91, 58.64 },
                { -50.19, 59.81 }, { -50.44, 60.97 }, { -50.81, 62.19 }, { -51.08, 63.42 }, { -51.36, 64.53 },
                { -51.73, 65.75 }, { -52.07, 66.97 }, { -52.35, 68.03 }, { -52.74, 69.31 }, { -53.25, 70.53 },
                { -53.66, 71.69 }, { -54.17, 72.92 }, { -180, 87.8299454933249 }, { -180, 87.62686029625328 },
                { -146.33, 74.64 } } };

        List<double[][][]> polygonNormalized = GeoHelper.sanitizePolygon(polygonFailingOnThor);
        Assert.assertEquals(1, polygonNormalized.size());

        List<double[]> expectedPolygon2 = Lists.newArrayList(new double[] { -180.0, 87.62686029625328 },
                                                             new double[] { -146.33, 74.64 },
                                                             new double[] { -91.35, 66.92 });
        for (int i = 0; i < expectedPolygon2.size(); i++) {
            Assert.assertArrayEquals(expectedPolygon2.get(i), polygonNormalized.get(0)[0][i], 0.001);
        }
    }

    @Test
    public void testSanitizePolygoneBasicPolygon() {
        double[][][] polygonThatShouldBeSplitted = new double[][][] { {

            { 170, 30 }, { 170, 15 }, { -170, 15 }, { -170, 30 }, { 170, 30 } } };
        List<double[][][]> polygonNormalized = GeoHelper.sanitizePolygon(polygonThatShouldBeSplitted);

        Assert.assertEquals(2, polygonNormalized.size());
        Assert.assertArrayEquals(new double[] { 180.0, 15.0 }, polygonNormalized.get(0)[0][0], 0);
        Assert.assertArrayEquals(new double[] { 180.0, 30.0 }, polygonNormalized.get(0)[0][1], 0);
        Assert.assertArrayEquals(new double[] { 170.0, 30.0 }, polygonNormalized.get(0)[0][2], 0);
        Assert.assertArrayEquals(new double[] { 170.0, 15.0 }, polygonNormalized.get(0)[0][3], 0);
        Assert.assertArrayEquals(new double[] { 180.0, 15.0 }, polygonNormalized.get(0)[0][4], 0);

        Assert.assertArrayEquals(new double[] { -180.0, 30.0 }, polygonNormalized.get(1)[0][0], 0);
        Assert.assertArrayEquals(new double[] { -180.0, 15.0 }, polygonNormalized.get(1)[0][1], 0);
        Assert.assertArrayEquals(new double[] { -170.0, 15.0 }, polygonNormalized.get(1)[0][2], 0);
        Assert.assertArrayEquals(new double[] { -170.0, 30.0 }, polygonNormalized.get(1)[0][3], 0);
        Assert.assertArrayEquals(new double[] { -180.0, 30.0 }, polygonNormalized.get(1)[0][4], 0);

    }

    @Test
    public void testSomeInvalidAdeoFeature() {

        double[][][] polygonThatShouldBeSplitted = new double[][][] {
            { { -62.14, -68.97 }, { -64.12, -52.14 }, { -64.1, -50.92 }, { -64.0, -49.81 }, { -63.91, -48.69 },
                { -63.88, -47.53 }, { -63.76, -46.53 }, { -63.62, -45.31 }, { -63.55, -44.25 }, { -63.48, -43.03 },
                { -63.35, -41.92 }, { -63.24, -40.75 }, { -63.09, -39.64 }, { -62.95, -38.53 }, { -62.84, -37.47 },
                { -62.72, -36.25 }, { -62.59, -35.14 }, { -62.45, -34.03 }, { -62.31, -32.92 }, { -62.17, -31.75 },
                { -61.99, -30.58 }, { -61.84, -29.53 }, { -61.65, -28.36 }, { -61.55, -27.19 }, { -61.33, -26.08 },
                { -61.17, -24.92 }, { -61.0, -23.81 }, { -60.85, -22.69 }, { -60.65, -21.53 }, { -60.44, -20.42 },
                { -60.3, -19.31 }, { -60.09, -18.19 }, { -59.87, -17.03 }, { -59.74, -15.86 }, { -59.51, -14.81 },
                { -59.3, -13.64 }, { -59.14, -12.47 }, { -58.9, -11.36 }, { -58.67, -10.19 }, { -58.49, -9.14 },
                { -58.49, -9.08 }, { -58.25, -7.97 }, { -58.0, -6.86 }, { -58.0, -6.81 }, { -57.76, -5.69 },
                { -57.54, -4.53 }, { -57.3, -3.42 }, { -57.08, -2.31 }, { -56.82, -1.25 }, { -56.82, -1.19 },
                { -56.82, -1.14 }, { -56.53, -0.03 }, { -56.32, 1.03 }, { -56.32, 1.08 }, { -56.06, 2.14 },
                { -56.06, 2.19 }, { -56.06, 2.25 }, { -55.74, 3.36 }, { -55.48, 4.47 }, { -55.25, 5.64 },
                { -54.96, 6.69 }, { -54.96, 6.75 }, { -54.64, 7.86 }, { -54.37, 8.97 }, { -54.37, 9.03 },
                { -54.05, 10.14 }, { -53.72, 11.25 }, { -53.43, 12.36 }, { -53.11, 13.53 }, { -52.78, 14.58 },
                { -52.49, 15.69 }, { -52.1, 16.86 }, { -51.77, 17.97 }, { -51.41, 19.08 }, { -51.05, 20.19 },
                { -50.65, 21.31 }, { -50.27, 22.42 }, { -49.89, 23.53 }, { -49.48, 24.64 }, { -49.07, 25.75 },
                { -48.67, 26.86 }, { -48.22, 27.97 }, { -47.78, 29.08 }, { -47.28, 30.19 }, { -46.82, 31.25 },
                { -46.33, 32.36 }, { -45.83, 33.42 }, { -45.32, 34.47 }, { -44.74, 35.64 }, { -44.24, 36.69 },
                { -43.67, 37.75 }, { -43.06, 38.86 }, { -42.48, 39.92 }, { -41.84, 40.97 }, { -41.13, 41.97 },
                { -40.44, 43.08 }, { -39.75, 44.14 }, { -38.99, 45.19 }, { -38.24, 46.19 }, { -37.45, 47.25 },
                { -36.59, 48.25 }, { -35.7, 49.25 }, { -34.79, 50.25 }, { -33.86, 51.25 }, { -32.89, 52.25 },
                { -31.79, 53.25 }, { -30.71, 54.19 }, { -29.55, 55.19 }, { -28.32, 56.08 }, { -27.01, 57.03 },
                { -25.72, 57.97 }, { -24.34, 58.86 }, { -22.78, 59.75 }, { -21.21, 60.58 }, { -19.57, 61.42 },
                { -17.83, 62.25 }, { -15.98, 63.03 }, { -14.03, 63.81 }, { -11.97, 64.58 }, { -9.76, 65.25 },
                { -7.44, 65.97 }, { -5.1, 66.58 }, { -2.51, 67.19 }, { 0.22, 67.75 }, { 2.92, 68.25 }, { 5.89, 68.69 },
                { 8.81, 69.14 }, { 11.96, 69.47 }, { 15.21, 69.81 }, { 18.57, 69.97 }, { 21.99, 70.14 },
                { 25.4, 70.25 }, { 28.85, 70.25 }, { 32.23, 70.31 }, { -179.4, 87.36 }, { -154.38, 87.58 },
                { -128.66, 87.36 }, { -109.25, 86.69 }, { -97.79, 85.92 }, { -90.63, 84.92 }, { -85.8, 83.92 },
                { -82.24, 82.81 }, { -79.68, 81.81 }, { -77.81, 80.69 }, { -76.33, 79.58 }, { -75.35, 78.42 },
                { -74.45, 77.31 }, { -73.7, 76.19 }, { -73.1, 75.14 }, { -72.7, 73.97 }, { -72.09, 72.86 },
                { -71.91, 71.75 }, { -71.62, 70.58 }, { -71.38, 69.47 }, { -71.14, 68.31 }, { -71.15, 67.19 },
                { -70.89, 66.08 }, { -70.94, 64.92 }, { -70.8, 63.81 }, { -70.78, 62.64 }, { -70.69, 61.47 },
                { -70.73, 60.36 }, { -70.69, 59.19 }, { -70.77, 58.08 }, { -70.79, 56.97 }, { -70.84, 55.75 },
                { -70.9, 54.64 }, { -70.98, 53.53 }, { -71.01, 52.31 }, { -71.07, 51.19 }, { -71.21, 50.08 },
                { -71.23, 48.92 }, { -71.36, 47.75 }, { -71.49, 46.58 }, { -71.56, 45.53 }, { -71.7, 44.36 },
                { -71.82, 43.19 }, { -71.96, 42.08 }, { -72.1, 40.92 }, { -72.22, 39.75 }, { -72.36, 38.64 },
                { -72.46, 37.53 }, { -72.61, 36.36 }, { -72.78, 35.14 }, { -72.91, 34.03 }, { -73.09, 32.92 },
                { -73.22, 31.69 }, { -73.38, 30.64 }, { -73.54, 29.47 }, { -73.72, 28.31 }, { -73.92, 27.19 },
                { -74.06, 25.97 }, { -74.23, 24.86 }, { -74.42, 23.81 }, { -74.63, 22.58 }, { -74.81, 21.42 },
                { -74.92, 20.36 }, { -75.21, 19.19 }, { -75.39, 18.03 }, { -75.57, 16.92 }, { -75.77, 15.81 },
                { -75.99, 14.64 }, { -76.21, 13.42 }, { -76.41, 12.36 }, { -76.6, 11.25 }, { -76.88, 10.08 },
                { -77.03, 8.97 }, { -77.3, 7.81 }, { -77.3, 7.75 }, { -77.55, 6.64 }, { -77.78, 5.58 },
                { -77.78, 5.53 }, { -77.78, 5.47 }, { -78.05, 4.42 }, { -78.26, 3.31 }, { -78.52, 2.14 },
                { -78.52, 2.08 }, { -78.72, 1.03 }, { -79.03, -0.14 }, { -79.27, -1.25 }, { -79.55, -2.36 },
                { -79.84, -3.53 }, { -80.08, -4.64 }, { -80.08, -4.69 }, { -80.39, -5.81 }, { -80.68, -6.92 },
                { -80.68, -6.97 }, { -80.94, -8.03 }, { -80.94, -8.08 }, { -81.22, -9.14 }, { -81.56, -10.25 },
                { -81.9, -11.36 }, { -82.18, -12.47 }, { -82.51, -13.64 }, { -82.84, -14.81 }, { -83.19, -15.86 },
                { -83.55, -16.97 }, { -83.89, -18.08 }, { -84.26, -19.19 }, { -84.64, -20.25 }, { -84.99, -21.36 },
                { -85.34, -22.47 }, { -85.76, -23.53 }, { -86.18, -24.69 }, { -86.61, -25.81 }, { -86.98, -26.81 },
                { -87.49, -27.92 }, { -87.9, -29.03 }, { -88.36, -30.08 }, { -88.83, -31.14 }, { -89.31, -32.25 },
                { -89.83, -33.31 }, { -90.34, -34.42 }, { -90.89, -35.47 }, { -91.49, -36.53 }, { -92.07, -37.58 },
                { -92.56, -38.69 }, { -93.25, -39.81 }, { -93.89, -40.75 }, { -94.55, -41.86 }, { -95.15, -42.86 },
                { -95.89, -43.86 }, { -96.63, -44.92 }, { -97.39, -45.92 }, { -98.23, -47.03 }, { -114.46, -60.92 },
                { -62.14, -68.97 } } };

        List<double[][][]> polygonNormalized = GeoHelper.sanitizePolygon(polygonThatShouldBeSplitted);

        Assert.assertEquals(1, polygonNormalized.size());
    }

    @Test
    public void testAnotherInvalidAdeoFeature() {

        double[][][] polygonThatShouldBeSplitted = new double[][][] {

            { { -18.81, -63.42 }, { -19.57, -46.47 }, { -19.47, -45.31 }, { -19.41, -44.19 }, { -19.26, -43.03 },
                { -19.15, -41.92 }, { -19.05, -40.81 }, { -18.95, -39.69 }, { -18.8, -38.58 }, { -18.64, -37.42 },
                { -18.51, -36.31 }, { -18.39, -35.19 }, { -18.27, -34.03 }, { -18.1, -32.92 }, { -17.95, -31.81 },
                { -17.79, -30.64 }, { -17.71, -29.47 }, { -17.52, -28.36 }, { -17.34, -27.25 }, { -17.16, -26.08 },
                { -17.01, -24.97 }, { -16.85, -23.81 }, { -16.65, -22.69 }, { -16.46, -21.58 }, { -16.28, -20.47 },
                { -16.1, -19.31 }, { -15.93, -18.14 }, { -15.72, -17.03 }, { -15.51, -15.92 }, { -15.37, -14.75 },
                { -15.12, -13.64 }, { -14.93, -12.47 }, { -14.7, -11.36 }, { -14.48, -10.31 }, { -14.48, -10.25 },
                { -14.26, -9.14 }, { -14.26, -9.08 }, { -14.05, -7.97 }, { -13.85, -6.86 }, { -13.85, -6.81 },
                { -13.59, -5.69 }, { -13.35, -4.58 }, { -13.11, -3.47 }, { -13.11, -3.42 }, { -12.87, -2.31 },
                { -12.64, -1.25 }, { -12.64, -1.19 }, { -12.36, -0.08 }, { -12.14, 1.08 }, { -11.87, 2.14 },
                { -11.87, 2.19 }, { -11.87, 2.25 }, { -11.6, 3.25 }, { -11.6, 3.31 }, { -11.34, 4.42 },
                { -11.34, 4.47 }, { -11.02, 5.58 }, { -10.77, 6.69 }, { -10.77, 6.75 }, { -10.51, 7.81 },
                { -10.51, 7.86 }, { -10.21, 8.92 }, { -9.9, 10.03 }, { -9.6, 11.19 }, { -9.6, 11.25 }, { -9.3, 12.36 },
                { -8.94, 13.47 }, { -8.64, 14.53 }, { -8.64, 14.58 }, { -8.28, 15.69 }, { -7.98, 16.75 },
                { -7.62, 17.97 }, { -7.26, 19.08 }, { -6.9, 20.19 }, { -6.53, 21.31 }, { -6.16, 22.36 },
                { -5.79, 23.53 }, { -5.35, 24.58 }, { -4.96, 25.64 }, { -4.51, 26.81 }, { -4.06, 27.92 },
                { -3.59, 29.03 }, { -3.18, 30.08 }, { -2.69, 31.19 }, { -2.2, 32.31 }, { -1.7, 33.36 },
                { -1.18, 34.47 }, { -0.58, 35.58 }, { -0.03, 36.69 }, { 0.53, 37.75 }, { 1.1, 38.81 }, { 1.7, 39.92 },
                { 2.39, 40.97 }, { 3.03, 42.03 }, { 3.69, 43.08 }, { 4.45, 44.08 }, { 5.16, 45.14 }, { 5.9, 46.19 },
                { 6.74, 47.19 }, { 7.55, 48.25 }, { 8.47, 49.25 }, { 9.34, 50.25 }, { 10.25, 51.25 }, { 11.3, 52.25 },
                { 12.39, 53.25 }, { 13.43, 54.19 }, { 14.63, 55.14 }, { 15.78, 56.08 }, { 17.1, 57.03 },
                { 18.46, 57.92 }, { 19.83, 58.86 }, { 21.34, 59.75 }, { 22.91, 60.58 }, { 24.56, 61.42 },
                { 26.3, 62.25 }, { 28.16, 63.08 }, { 30.08, 63.86 }, { 32.24, 64.53 }, { 34.31, 65.25 },
                { 36.69, 65.92 }, { 39.06, 66.58 }, { 41.68, 67.14 }, { 44.27, 67.69 }, { 47.14, 68.25 },
                { 49.93, 68.69 }, { 53.13, 69.08 }, { 56.17, 69.47 }, { 59.33, 69.69 }, { 62.68, 69.97 },
                { 65.98, 70.19 }, { 69.45, 70.25 }, { 72.9, 70.25 }, { 76.31, 70.19 }, { -134.41, 87.31 },
                { -109.71, 87.58 }, { -83.96, 87.36 }, { -66.03, 86.75 }, { -54.23, 85.86 }, { -46.1, 84.92 },
                { -41.72, 83.92 }, { -37.91, 82.81 }, { -35.42, 81.75 }, { -33.64, 80.64 }, { -32.24, 79.53 },
                { -31.11, 78.42 }, { -30.21, 77.31 }, { -29.34, 76.14 }, { -28.6, 75.08 }, { -28.36, 73.92 },
                { -27.9, 72.81 }, { -27.67, 71.69 }, { -27.33, 70.58 }, { -27.1, 69.42 }, { -27.12, 68.31 },
                { -26.95, 67.14 }, { -26.82, 65.97 }, { -26.66, 64.92 }, { -26.69, 63.75 }, { -26.6, 62.58 },
                { -26.59, 61.47 }, { -26.57, 60.36 }, { -26.64, 59.19 }, { -26.59, 58.03 }, { -26.61, 56.92 },
                { -26.71, 55.75 }, { -26.74, 54.64 }, { -26.78, 53.53 }, { -26.88, 52.36 }, { -26.94, 51.25 },
                { -27.06, 50.08 }, { -27.1, 48.92 }, { -27.26, 47.81 }, { -27.3, 46.64 }, { -27.43, 45.42 },
                { -27.55, 44.36 }, { -27.65, 43.25 }, { -27.8, 42.08 }, { -27.9, 40.92 }, { -28.02, 39.81 },
                { -28.2, 38.64 }, { -28.32, 37.47 }, { -28.44, 36.31 }, { -28.58, 35.19 }, { -28.73, 34.03 },
                { -28.89, 32.92 }, { -29.04, 31.75 }, { -29.2, 30.58 }, { -29.38, 29.47 }, { -29.56, 28.31 },
                { -29.7, 27.19 }, { -29.9, 26.03 }, { -30.05, 24.92 }, { -30.25, 23.75 }, { -30.43, 22.64 },
                { -30.66, 21.47 }, { -30.83, 20.31 }, { -31.03, 19.19 }, { -31.23, 18.03 }, { -31.44, 16.92 },
                { -31.61, 15.81 }, { -31.61, 15.75 }, { -31.83, 14.58 }, { -31.83, 14.53 }, { -32.03, 13.53 },
                { -32.27, 12.36 }, { -32.48, 11.19 }, { -32.69, 10.03 }, { -32.69, 9.97 }, { -32.92, 8.92 },
                { -32.92, 8.86 }, { -33.17, 7.81 }, { -33.37, 6.69 }, { -33.37, 6.64 }, { -33.63, 5.53 },
                { -33.63, 5.47 }, { -33.8, 4.42 }, { -34.08, 3.25 }, { -34.08, 3.19 }, { -34.33, 2.14 },
                { -34.33, 2.08 }, { -34.33, 2.03 }, { -34.58, 0.97 }, { -34.86, -0.14 }, { -34.86, -0.19 },
                { -35.09, -1.25 }, { -35.09, -1.31 }, { -35.09, -1.36 }, { -35.34, -2.42 }, { -35.65, -3.53 },
                { -35.65, -3.58 }, { -35.93, -4.69 }, { -35.93, -4.75 }, { -36.22, -5.81 }, { -36.22, -5.86 },
                { -36.46, -6.92 }, { -36.46, -6.97 }, { -36.78, -8.08 }, { -37.11, -9.14 }, { -37.41, -10.31 },
                { -37.66, -11.42 }, { -38.04, -12.53 }, { -38.33, -13.58 }, { -38.33, -13.64 }, { -38.64, -14.75 },
                { -39.02, -15.92 }, { -39.36, -17.03 }, { -39.72, -18.14 }, { -40.03, -19.19 }, { -40.42, -20.31 },
                { -40.84, -21.36 }, { -41.21, -22.47 }, { -41.62, -23.58 }, { -42.03, -24.69 }, { -42.41, -25.75 },
                { -42.88, -26.86 }, { -43.32, -27.97 }, { -43.78, -29.08 }, { -44.16, -30.14 }, { -44.71, -31.19 },
                { -45.21, -32.36 }, { -45.67, -33.36 }, { -46.23, -34.42 }, { -46.69, -35.47 }, { -47.32, -36.64 },
                { -47.84, -37.58 }, { -48.47, -38.75 }, { -49.03, -39.75 }, { -49.67, -40.75 }, { -50.35, -41.81 },
                { -62.91, -56.58 }, { -18.81, -63.42 } }

        };

        List<double[][][]> polygonNormalized = GeoHelper.sanitizePolygon(polygonThatShouldBeSplitted);

        Assert.assertEquals(1, polygonNormalized.size());
    }

    @Test
    public void testValidAdeoFeature() {

        double[][][] polygonThatShouldBeSplitted = new double[][][] {
            { { -176.8, -55.64 }, { 146.66, -50.03 }, { 155.8, -34.64 }, { 156.36, -33.58 }, { 156.82, -32.58 },
                { 157.35, -31.53 }, { 157.81, -30.42 }, { 158.3, -29.36 }, { 158.73, -28.19 }, { 159.24, -27.14 },
                { 159.62, -26.08 }, { 160.05, -24.97 }, { 160.46, -23.92 }, { 160.87, -22.75 }, { 161.26, -21.69 },
                { 161.64, -20.53 }, { 162, -19.47 }, { 162.35, -18.36 }, { 162.7, -17.19 }, { 163.03, -16.08 },
                { 163.41, -14.97 }, { 163.72, -13.92 }, { 164.02, -12.75 }, { 164.37, -11.69 }, { 164.37, -11.64 },
                { 164.71, -10.53 }, { 165, -9.36 }, { 165.26, -8.36 }, { 165.26, -8.31 }, { 165.58, -7.19 },
                { 165.84, -6.03 }, { 166.2, -4.92 }, { 166.44, -3.86 }, { 166.44, -3.81 }, { 166.44, -3.75 },
                { 166.68, -2.69 }, { 166.97, -1.58 }, { 166.97, -1.53 }, { 167.25, -0.47 }, { 167.25, -0.42 },
                { 167.25, -0.36 }, { 167.47, 0.75 }, { 167.74, 1.81 }, { 167.74, 1.86 }, { 168.01, 3.03 },
                { 168.22, 4.14 }, { 168.48, 5.25 }, { 168.74, 6.36 }, { 168.74, 6.42 }, { 168.99, 7.53 },
                { 168.99, 7.58 }, { 169.18, 8.64 }, { 169.18, 8.69 }, { 169.43, 9.86 }, { 169.62, 10.97 },
                { 169.86, 12.08 }, { 169.86, 12.14 }, { 170.04, 13.25 }, { 170.28, 14.42 }, { 170.46, 15.53 },
                { 170.69, 16.69 }, { 170.87, 17.81 }, { 171.1, 18.97 }, { 171.28, 20.08 }, { 171.51, 21.25 },
                { 171.68, 22.42 }, { 171.85, 23.53 }, { 172.02, 24.64 }, { 172.19, 25.81 }, { 172.43, 26.97 },
                { 172.54, 28.08 }, { 172.71, 29.25 }, { 172.89, 30.36 }, { 173.06, 31.53 }, { 173.17, 32.69 },
                { 173.41, 33.81 }, { 173.53, 34.97 }, { 173.64, 36.08 }, { 173.82, 37.25 }, { 173.94, 38.36 },
                { 174.06, 39.53 }, { 174.18, 40.69 }, { 174.37, 41.86 }, { 174.5, 42.97 }, { 174.54, 44.14 },
                { 174.67, 45.25 }, { 174.8, 46.42 }, { 174.93, 47.58 }, { 174.99, 48.69 }, { 175.13, 49.86 },
                { 175.19, 51.03 }, { 175.25, 52.14 }, { 175.31, 53.25 }, { 175.37, 54.42 }, { 175.53, 55.58 },
                { 175.5, 56.69 }, { 175.56, 57.86 }, { 175.53, 58.97 }, { 175.59, 60.14 }, { 175.55, 61.31 },
                { 175.62, 62.42 }, { 175.45, 63.53 }, { 175.4, 64.64 }, { 175.32, 65.81 }, { 175.25, 66.92 },
                { 175.16, 68.08 }, { 174.92, 69.19 }, { 174.63, 70.36 }, { 174.5, 71.47 }, { 174.14, 72.64 },
                { 173.75, 73.75 }, { 173.3, 74.86 }, { 172.75, 76.03 }, { 171.92, 77.08 }, { 171.14, 78.25 },
                { 170.22, 79.36 }, { 168.75, 80.47 }, { 166.98, 81.53 }, { 164.6, 82.64 }, { 161.54, 83.69 },
                { 156.59, 84.75 }, { 150, 85.69 }, { 139.43, 86.58 }, { 122.52, 87.25 }, { 97.88, 87.58 },
                { 71.88, 87.36 }, { -82.27, 70.25 }, { -85.56, 70.25 }, { -89.09, 70.31 }, { -92.53, 70.08 },
                { -95.82, 69.92 }, { -99.1, 69.64 }, { -102.37, 69.36 }, { -105.44, 69.03 }, { -108.53, 68.64 },
                { -111.27, 68.14 }, { -114.09, 67.64 }, { -116.74, 67.08 }, { -119.23, 66.47 }, { -121.78, 65.81 },
                { -123.9, 65.14 }, { -126.15, 64.42 }, { -128.17, 63.69 }, { -130.15, 62.92 }, { -132, 62.08 },
                { -133.73, 61.25 }, { -135.39, 60.42 }, { -136.89, 59.53 }, { -138.26, 58.69 }, { -139.66, 57.75 },
                { -141.02, 56.86 }, { -142.29, 55.92 }, { -143.56, 54.97 }, { -144.63, 53.97 }, { -145.78, 53.03 },
                { -146.74, 52.03 }, { -147.76, 51.08 }, { -148.7, 50.08 }, { -149.59, 49.08 }, { -150.47, 48.03 },
                { -151.36, 47.03 }, { -152.06, 45.97 }, { -152.87, 44.97 }, { -153.59, 43.92 }, { -154.35, 42.86 },
                { -154.99, 41.81 }, { -155.64, 40.69 }, { -156.28, 39.69 }, { -156.87, 38.58 }, { -157.48, 37.53 },
                { -158.06, 36.47 }, { -158.64, 35.36 }, { -159.18, 34.31 }, { -159.65, 33.19 }, { -160.16, 32.14 },
                { -160.64, 31.03 }, { -161.12, 29.92 }, { -161.58, 28.86 }, { -162.01, 27.75 }, { -162.5, 26.64 },
                { -162.92, 25.53 }, { -163.31, 24.42 }, { -163.7, 23.31 }, { -164.13, 22.19 }, { -164.49, 21.08 },
                { -164.84, 19.97 }, { -165.23, 18.86 }, { -165.56, 17.75 }, { -165.94, 16.64 }, { -166.25, 15.53 },
                { -166.61, 14.36 }, { -166.9, 13.25 }, { -167.24, 12.14 }, { -167.24, 12.08 }, { -167.52, 11.03 },
                { -167.85, 9.86 }, { -168.11, 8.75 }, { -168.42, 7.64 }, { -168.73, 6.53 }, { -168.73, 6.47 },
                { -168.98, 5.36 }, { -169.28, 4.25 }, { -169.57, 3.14 }, { -169.57, 3.08 }, { -169.57, 3.03 },
                { -169.8, 1.97 }, { -170.08, 0.86 }, { -170.31, -0.25 }, { -170.31, -0.31 }, { -170.58, -1.42 },
                { -170.58, -1.47 }, { -170.85, -2.53 }, { -171.06, -3.69 }, { -171.06, -3.75 }, { -171.33, -4.86 },
                { -171.54, -5.97 }, { -171.54, -6.03 }, { -171.74, -7.08 }, { -172, -8.19 }, { -172.2, -9.36 },
                { -172.4, -10.47 }, { -172.65, -11.64 }, { -172.65, -11.69 }, { -172.85, -12.75 }, { -173.05, -13.86 },
                { -173.24, -15.03 }, { -173.49, -16.19 }, { -173.49, -16.25 }, { -173.68, -17.36 }, { -173.82, -18.42 },
                { -174.08, -19.53 }, { -174.21, -20.69 }, { -174.4, -21.86 }, { -174.6, -23.03 }, { -174.74, -24.08 },
                { -174.93, -25.25 }, { -175.07, -26.36 }, { -175.27, -27.53 }, { -175.41, -28.64 }, { -175.61, -29.81 },
                { -175.76, -30.86 }, { -175.9, -32.03 }, { -176.05, -33.19 }, { -176.2, -34.36 }, { -176.35, -35.47 },
                { -176.44, -36.53 }, { -176.6, -37.64 }, { -176.75, -38.86 }, { -176.8, -55.64 } } };

        List<double[][][]> polygonNormalized = GeoHelper.sanitizePolygon(polygonThatShouldBeSplitted);

        Assert.assertEquals(1, polygonNormalized.size());

    }

    @Test
    public void testStrangeAdeoFeature() {
        double[][][] polygonThatShouldBeSplitted = new double[][][] {
            { { -94.75, -57.86 }, { -94.89, -40.97 }, { -94.77, -39.81 }, { -94.63, -38.69 }, { -94.45, -37.58 },
                { -94.35, -36.42 }, { -94.19, -35.31 }, { -94.06, -34.14 }, { -93.94, -33.03 }, { -93.76, -31.92 },
                { -93.65, -30.75 }, { -93.48, -29.64 }, { -93.29, -28.53 }, { -93.16, -27.36 }, { -93, -26.25 },
                { -92.82, -25.14 }, { -92.67, -23.97 }, { -92.47, -22.86 }, { -92.27, -21.75 }, { -92.08, -20.58 },
                { -91.91, -19.42 }, { -91.73, -18.31 }, { -91.51, -17.19 }, { -91.33, -16.08 }, { -91.15, -14.92 },
                { -90.94, -13.86 }, { -90.94, -13.81 }, { -90.74, -12.69 }, { -90.74, -12.64 }, { -90.51, -11.53 },
                { -90.31, -10.47 }, { -90.08, -9.25 }, { -89.86, -8.08 }, { -89.64, -7.03 }, { -89.64, -6.97 },
                { -89.39, -5.86 }, { -89.16, -4.75 }, { -89.16, -4.69 }, { -88.91, -3.58 }, { -88.72, -2.53 },
                { -88.72, -2.47 }, { -88.72, -2.42 }, { -88.44, -1.36 }, { -88.44, -1.31 }, { -88.19, -0.19 },
                { -87.97, 0.86 }, { -87.97, 0.92 }, { -87.97, 0.97 }, { -87.69, 2.03 }, { -87.69, 2.08 },
                { -87.44, 3.14 }, { -87.44, 3.19 }, { -87.16, 4.25 }, { -87.16, 4.31 }, { -87.16, 4.36 },
                { -86.87, 5.47 }, { -86.59, 6.53 }, { -86.59, 6.58 }, { -86.3, 7.69 }, { -86.01, 8.86 },
                { -85.71, 9.97 }, { -85.39, 11.08 }, { -85.11, 12.19 }, { -84.77, 13.36 }, { -84.49, 14.47 },
                { -84.12, 15.58 }, { -83.79, 16.69 }, { -83.43, 17.86 }, { -83.1, 18.97 }, { -82.72, 20.08 },
                { -82.35, 21.14 }, { -81.98, 22.31 }, { -81.58, 23.42 }, { -81.18, 24.53 }, { -80.76, 25.64 },
                { -80.36, 26.75 }, { -79.92, 27.81 }, { -79.43, 28.92 }, { -79.03, 30.03 }, { -78.51, 31.14 },
                { -78.02, 32.19 }, { -77.54, 33.31 }, { -77.01, 34.36 }, { -76.47, 35.42 }, { -75.93, 36.53 },
                { -75.37, 37.64 }, { -74.77, 38.69 }, { -74.1, 39.75 }, { -73.52, 40.81 }, { -72.84, 41.86 },
                { -72.17, 42.92 }, { -71.44, 43.97 }, { -70.78, 45.03 }, { -69.96, 46.03 }, { -69.15, 47.08 },
                { -68.31, 48.14 }, { -67.46, 49.14 }, { -66.51, 50.14 }, { -65.65, 51.14 }, { -64.66, 52.14 },
                { -63.56, 53.14 }, { -62.54, 54.08 }, { -61.31, 55.03 }, { -60.12, 55.97 }, { -58.86, 56.92 },
                { -57.48, 57.86 }, { -56.06, 58.75 }, { -54.56, 59.64 }, { -53.03, 60.47 }, { -51.4, 61.36 },
                { -49.64, 62.14 }, { -48, 62.97 }, { -46.04, 63.75 }, { -44, 64.53 }, { -41.79, 65.19 },
                { -39.46, 65.86 }, { -37.02, 66.53 }, { -34.53, 67.14 }, { -31.83, 67.69 }, { -29.03, 68.14 },
                { -26.16, 68.64 }, { -23.1, 69.08 }, { -19.99, 69.42 }, { -16.73, 69.69 }, { -13.5, 69.92 },
                { -10.03, 70.08 }, { -6.64, 70.19 }, { -3.21, 70.25 }, { 0.08, 70.25 }, { 152.82, 87.36 },
                { -179.32, 87.64 }, { -158.09, 87.31 }, { -139.74, 86.64 }, { -128.73, 85.81 }, { -121.33, 84.81 },
                { -117.03, 83.75 }, { -113.81, 82.69 }, { -111.02, 81.64 }, { -109.59, 80.53 }, { -108.15, 79.42 },
                { -106.99, 78.31 }, { -105.98, 77.14 }, { -105.25, 76.08 }, { -104.68, 74.97 }, { -104.18, 73.86 },
                { -103.91, 72.69 }, { -103.5, 71.53 }, { -103.22, 70.36 }, { -103.05, 69.31 }, { -102.8, 68.08 },
                { -102.66, 67.03 }, { -102.54, 65.81 }, { -102.44, 64.75 }, { -102.51, 63.64 }, { -102.4, 62.53 },
                { -102.32, 61.31 }, { -102.37, 60.25 }, { -102.43, 59.08 }, { -102.37, 57.86 }, { -102.42, 56.75 },
                { -102.5, 55.64 }, { -102.52, 54.47 }, { -102.61, 53.36 }, { -102.64, 52.19 }, { -102.74, 51.08 },
                { -102.81, 49.92 }, { -102.88, 48.69 }, { -103.03, 47.64 }, { -103.09, 46.42 }, { -103.2, 45.36 },
                { -103.33, 44.19 }, { -103.37, 43.03 }, { -103.51, 41.92 }, { -103.64, 40.75 }, { -103.78, 39.64 },
                { -103.91, 38.47 }, { -104.05, 37.36 }, { -104.18, 36.19 }, { -104.32, 35.03 }, { -104.49, 33.86 },
                { -104.66, 32.75 }, { -104.78, 31.64 }, { -104.98, 30.42 }, { -105.16, 29.31 }, { -105.28, 28.19 },
                { -105.5, 27.03 }, { -105.65, 25.86 }, { -105.83, 24.64 }, { -106.04, 23.64 }, { -106.26, 22.47 },
                { -106.46, 21.31 }, { -106.63, 20.19 }, { -106.78, 19.08 }, { -106.99, 17.92 }, { -107.21, 16.81 },
                { -107.42, 15.58 }, { -107.64, 14.42 }, { -107.79, 13.36 }, { -108.07, 12.19 }, { -108.28, 10.97 },
                { -108.47, 9.92 }, { -108.47, 9.86 }, { -108.71, 8.69 }, { -108.95, 7.64 }, { -109.18, 6.47 },
                { -109.39, 5.42 }, { -109.39, 5.36 }, { -109.39, 5.31 }, { -109.67, 4.25 }, { -109.67, 4.19 },
                { -109.92, 3.08 }, { -109.92, 3.03 }, { -110.15, 1.97 }, { -110.15, 1.92 }, { -110.42, 0.86 },
                { -110.42, 0.81 }, { -110.64, -0.25 }, { -110.64, -0.31 }, { -110.9, -1.42 }, { -110.9, -1.47 },
                { -111.13, -2.58 }, { -111.44, -3.64 }, { -111.44, -3.69 }, { -111.44, -3.75 }, { -111.74, -4.81 },
                { -112.04, -5.97 }, { -112.28, -7.08 }, { -112.28, -7.14 }, { -112.62, -8.19 }, { -112.92, -9.31 },
                { -112.92, -9.36 }, { -113.21, -10.42 }, { -113.53, -11.53 }, { -113.86, -12.64 }, { -113.86, -12.69 },
                { -114.17, -13.81 }, { -114.51, -14.86 }, { -114.85, -15.97 }, { -115.18, -17.19 }, { -115.51, -18.25 },
                { -115.91, -19.36 }, { -116.24, -20.42 }, { -116.67, -21.53 }, { -117.04, -22.69 }, { -117.42, -23.81 },
                { -117.85, -24.81 }, { -118.26, -25.92 }, { -118.66, -27.03 }, { -119.11, -28.14 }, { -119.57, -29.19 },
                { -120.05, -30.31 }, { -120.51, -31.36 }, { -120.95, -32.47 }, { -121.5, -33.47 }, { -122.06, -34.58 },
                { -122.61, -35.64 }, { -123.15, -36.69 }, { -133.11, -51.92 }, { -94.75, -57.86 } } };

        List<double[][][]> polygonNormalized = GeoHelper.sanitizePolygon(polygonThatShouldBeSplitted);

        Assert.assertEquals(1, polygonNormalized.size());

    }
}
